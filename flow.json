[{"id":"91f789ec.a4f17","type":"tab","label":"Playground, tests","disabled":false,"info":""},{"id":"f7a0cac1.5f5af","type":"tab","label":"MQTT","disabled":false,"info":""},{"id":"98b0effc.65096","type":"tab","label":"Sensors","disabled":false,"info":""},{"id":"f898b011.8cb44","type":"tab","label":"LCD","disabled":false,"info":""},{"id":"c16ac57b.fa21f","type":"tab","label":"Camera","disabled":false,"info":""},{"id":"44ed3281.52c5a4","type":"tab","label":"Sys","disabled":false,"info":""},{"id":"1c85e207.9c4a2e","type":"subflow","name":"Execute Shell Script","info":"","in":[{"x":100,"y":200,"wires":[{"id":"ec010d12.46a428"}]}],"out":[{"x":960,"y":280,"wires":[{"id":"68557c2a.a3dbec","port":0}]},{"x":960,"y":340,"wires":[{"id":"68557c2a.a3dbec","port":1}]},{"x":960,"y":400,"wires":[{"id":"68557c2a.a3dbec","port":2}]}]},{"id":"42ca863f.50d128","type":"mqtt-broker","z":"","name":"QNAP","broker":"10.0.10.30","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"958db5d8.45c0b8","type":"tls-config","z":"","name":"plant_thing","cert":"","key":"","ca":"","certname":"01d6fa5abe-certificate.pem.crt","keyname":"01d6fa5abe-private.pem.key","caname":"aws_root_CA.pem","servername":"","verifyservercert":true},{"id":"8251bee0.c70e98","type":"aws-config-s3","z":0},{"id":"e9d622c9.8920d8","type":"ina-sensor-manager","z":"","address":"0x40","delay":"13000","ohms":"0.01","customResistor":false},{"id":"1ac48f17.a5a1a1","type":"oled-config","z":"","name":"OLED","width":"128","height":"64","address":"0x3c"},{"id":"fd70a59a.423ef8","type":"mqtt-broker","z":"","name":"AWS","broker":"azajijbaqf61a-ats.iot.eu-central-1.amazonaws.com","port":"8883","tls":"958db5d8.45c0b8","clientid":"","usetls":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"df4c01ed.fb6238","type":"Bme280","z":"98b0effc.65096","name":"BME280","bus":"1","address":"0x76","topic":"bme280","extra":false,"x":280,"y":200,"wires":[["89a1f0fb.062d28","20a9c6bd.64feb2","69872bb9.1fa6bc","2eb5ceea.1a8862"]]},{"id":"2483a999.6ff35e","type":"inject","z":"98b0effc.65096","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":true,"onceDelay":"0.5","x":110,"y":200,"wires":[["df4c01ed.fb6238","3a5ddff4.6a5608","598099ce.7cb408","927c9eeb.97c33","905bfd7e.2b551"]]},{"id":"89a1f0fb.062d28","type":"function","z":"98b0effc.65096","name":"temperature","func":"newMsg = {};\nnewMsg.payload = msg.payload.temperature_C;\nnode.status({text: newMsg.payload});\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":530,"y":140,"wires":[["b748c139.806df"]]},{"id":"20a9c6bd.64feb2","type":"function","z":"98b0effc.65096","name":"humidity","func":"newMsg = {};\n// newMsg.payload = msg.payload.humidity;\nnewMsg.payload = JSON.parse(Number(msg.payload.humidity).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":520,"y":200,"wires":[["19d61a28.ce817e"]]},{"id":"69872bb9.1fa6bc","type":"function","z":"98b0effc.65096","name":"pressure","func":"newMsg = {};\nnewMsg.payload = JSON.parse(Number(msg.payload.pressure_hPa).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":520,"y":260,"wires":[["45183fd9.456ce8"]]},{"id":"aa4365c9.761a18","type":"link out","z":"98b0effc.65096","name":"bme280-readings","links":["6ab4dbc2.100f9c","30b0d6ec.62628a"],"x":675,"y":80,"wires":[]},{"id":"2eb5ceea.1a8862","type":"function","z":"98b0effc.65096","name":"topic bme280","func":"msg.topic=\"bme280\";\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":80,"wires":[["aa4365c9.761a18"]]},{"id":"db0c6d5d.5f565","type":"comment","z":"91f789ec.a4f17","name":"TODO list","info":"","x":80,"y":40,"wires":[]},{"id":"e81b166a.f93e98","type":"mqtt in","z":"f7a0cac1.5f5af","name":"","topic":"garden/weather/sensor/temperature","qos":"2","datatype":"auto","broker":"42ca863f.50d128","x":160,"y":180,"wires":[["23897e93.734fca"]]},{"id":"b0f5c114.a4bbc8","type":"mqtt in","z":"f7a0cac1.5f5af","name":"","topic":"garden/weather/sensor/humidity","qos":"2","datatype":"auto","broker":"42ca863f.50d128","x":150,"y":240,"wires":[["89e927b1.bfb0e8"]]},{"id":"7a858685.7a072","type":"yaml","z":"98b0effc.65096","property":"payload","name":"\"","x":410,"y":440,"wires":[["a35d5973.426f78","9d681f3d.eb09c8"]]},{"id":"cff98706.3b94","type":"switch","z":"98b0effc.65096","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"Full","vt":"str"},{"t":"cont","v":"IR","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":440,"wires":[["15e5d78c.d20e68"],["e5e4c2e4.056f38"]]},{"id":"a35d5973.426f78","type":"split","z":"98b0effc.65096","name":"","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":570,"y":440,"wires":[["cff98706.3b94"]]},{"id":"6465c5dc.369c24","type":"camerapi-takephoto","z":"c16ac57b.fa21f","filemode":"1","filename":"{{msg.payload.filename}}","filedefpath":"0","filepath":"/home/pi/pictures/","fileformat":"jpeg","resolution":"4","rotation":"0","fliph":"0","flipv":"0","brightness":"50","contrast":"0","sharpness":"0","quality":"80","imageeffect":"none","exposuremode":"auto","iso":"0","agcwait":"1.0","led":"1","awb":"auto","name":"take photo","x":630,"y":220,"wires":[["3baceda1.d3ef02"]]},{"id":"5068057d.fed9ec","type":"comment","z":"f898b011.8cb44","name":"","info":"","x":100,"y":60,"wires":[]},{"id":"d2639062.f8449","type":"function","z":"c16ac57b.fa21f","name":"name string","func":"var date;\ndate = new Date();\ndate = (date.getFullYear() + '-' + ('00' + (date.getMonth()+1)).slice(-2) + '-' + ('00' + date.getDate()).slice(-2) + 'T' + ('00' + date.getHours()).slice(-2) + ':' + ('00' + date.getMinutes()).slice(-2) + ':' + ('00' + date.getSeconds()).slice(-2));\n\nmsg.filename = \"plant_picture_\" + date + \".jpg\";\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":220,"wires":[["6465c5dc.369c24"]]},{"id":"6230aa.bfd8ff58","type":"inject","z":"f7a0cac1.5f5af","name":"start default values","topic":"","payload":"{\"deviceID\":\"plant\",\"age\":0,\"interval\":15,\"temperature\":20,\"humidity\":20,\"vpd\":0,\"pressure\":1000,\"temperature_outdoor\":20,\"humidity_outdoor\":20,\"light_full\":0,\"light_ir\":0,\"moisture\":1,\"ps_voltage\":0,\"ps_current\":0,\"ps_power\":0,\"load\":0,\"memory\":0,\"uptime\":0,\"air_co2\":0,\"air_tvoc\":0,\"air_temp\":0,\"weight\":0,\"image\":\"-\",\"presence\":0}","payloadType":"json","repeat":"900","crontab":"","once":true,"onceDelay":"5","x":140,"y":420,"wires":[["c118aa8c.c0b278","edaaba0a.0f615","4512474.90ab138"]]},{"id":"c118aa8c.c0b278","type":"function","z":"f7a0cac1.5f5af","name":"gather all global vars info to one msg","func":"msg.payload.deviceID+=\"01\";\nmsg.payload.age = global.get(\"age\");\nmsg.payload.interval = global.get(\"interval\");\nmsg.payload.timestamp=Date.now();\nmsg.payload.image = global.get(\"picture\");\nmsg.payload.temperature = global.get(\"temperature\");\nmsg.payload.temperature_outdoor = global.get(\"temperatureOutdoor\");\nmsg.payload.humidity = global.get(\"humidity\");\nmsg.payload.humidity_outdoor = global.get(\"humidityOutdoor\");\nmsg.payload.vpd = global.get(\"vpd\");\nmsg.payload.pressure = global.get(\"pressure\");\nmsg.payload.light_full = global.get(\"light_full\");\nmsg.payload.light_ir = global.get(\"light_ir\");\nmsg.payload.moisture = global.get(\"moisture\");\nmsg.payload.ps_voltage = global.get(\"voltage\");\nmsg.payload.ps_current = global.get(\"current\");\nmsg.payload.ps_power = global.get(\"power\");\nmsg.payload.load = global.get(\"load\");\nmsg.payload.memory = global.get(\"memory\");\nmsg.payload.uptime = global.get(\"uptime\");\nmsg.payload.air_co2 = global.get(\"airCO2\");\nmsg.payload.air_tvoc = global.get(\"airTVOC\");\nmsg.payload.air_temp = global.get(\"airTemp\");\nmsg.payload.weight = global.get(\"weight\");\nmsg.payload.presence = global.get(\"presence\");\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":440,"wires":[["5afaa662.def1f","f8c30f07.46c47"]]},{"id":"b748c139.806df","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"temperature","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":140,"wires":[[]]},{"id":"19d61a28.ce817e","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"humidity","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":200,"wires":[[]]},{"id":"45183fd9.456ce8","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"pressure","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":260,"wires":[[]]},{"id":"d4e772de.ce8fe8","type":"change","z":"f7a0cac1.5f5af","name":"","rules":[{"t":"set","p":"temperatureOutdoor","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":180,"wires":[["d06b603e.dcb508"]]},{"id":"8695e00.d675f2","type":"change","z":"f7a0cac1.5f5af","name":"","rules":[{"t":"set","p":"humidityOutdoor","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":240,"wires":[["2f00bdca.c7bb6a"]]},{"id":"15e5d78c.d20e68","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"light_full","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":420,"wires":[["27b09427.38588c"]]},{"id":"e5e4c2e4.056f38","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"light_ir","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":460,"wires":[[]]},{"id":"5afaa662.def1f","type":"debug","z":"f7a0cac1.5f5af","name":"aws","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":890,"y":380,"wires":[]},{"id":"d06b603e.dcb508","type":"debug","z":"f7a0cac1.5f5af","name":"temp outdoor","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":920,"y":180,"wires":[]},{"id":"23897e93.734fca","type":"yaml","z":"f7a0cac1.5f5af","property":"payload","name":"","x":390,"y":180,"wires":[["d4e772de.ce8fe8"]]},{"id":"89e927b1.bfb0e8","type":"yaml","z":"f7a0cac1.5f5af","property":"payload","name":"","x":390,"y":240,"wires":[["8695e00.d675f2"]]},{"id":"ab6d3327.3e6a38","type":"function","z":"c16ac57b.fa21f","name":"set file path & name","func":"msg.localFilename=global.get(\"filename\");\nmsg.filename=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":360,"wires":[["307355c7.fe05a2"]]},{"id":"2ee72ba5.62ce54","type":"debug","z":"c16ac57b.fa21f","name":"camera","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1020,"y":260,"wires":[]},{"id":"15f2f629.12335a","type":"debug","z":"c16ac57b.fa21f","name":"s3","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":360,"wires":[]},{"id":"307355c7.fe05a2","type":"amazon s3 put","z":"c16ac57b.fa21f","aws":"8251bee0.c70e98","bucket":"garden-of-tangled-data","filename":"","localFilename":"","contentType":"image/jpeg","contentEncoding":"","region":"eu-central-1","isBase64":"","name":"s3","acl":"private","outputs":1,"x":830,"y":360,"wires":[["15f2f629.12335a"]]},{"id":"9d681f3d.eb09c8","type":"debug","z":"98b0effc.65096","name":"LX","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":570,"y":380,"wires":[]},{"id":"8c9ea1fb.bf00b8","type":"ina-sensor","z":"98b0effc.65096","name":"","handle":"e9d622c9.8920d8","x":110,"y":840,"wires":[["4f33880d.f32a3"],["f4d9c349.68176","428b093.fec00f8"]]},{"id":"f1548d56.de3a38","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"voltage","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":800,"wires":[[]]},{"id":"321b7151.bd2ade","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"current","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":880,"wires":[[]]},{"id":"2f00bdca.c7bb6a","type":"debug","z":"f7a0cac1.5f5af","name":"humidity outdoor","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":930,"y":240,"wires":[]},{"id":"edaaba0a.0f615","type":"trigger","z":"f7a0cac1.5f5af","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":500,"y":380,"wires":[["3def2f42.dddaa"]]},{"id":"931c1691.01b86","type":"inject","z":"f898b011.8cb44","name":"led ping","topic":"","payload":"true","payloadType":"bool","repeat":"3","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":60,"wires":[["d9eb827b.deffc8"]]},{"id":"d9eb827b.deffc8","type":"trigger","z":"f898b011.8cb44","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"50","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":450,"y":60,"wires":[["8ca6e623.6d0388"]]},{"id":"5205ec1e.7b9b04","type":"String","z":"f898b011.8cb44","name":"oled","display":"1ac48f17.a5a1a1","x":610,"y":260,"wires":[]},{"id":"b7822373.5de7c","type":"inject","z":"f898b011.8cb44","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":true,"onceDelay":"5","x":110,"y":260,"wires":[["1a920d14.e83223","56baad6f.42d824","420e2c42.c78df4","2e3ba46c.0fe9dc"]]},{"id":"56baad6f.42d824","type":"function","z":"f898b011.8cb44","name":"uptime","func":"msg.payload = {\"size\":1,\"x\":1,\"y\":55,\"text\": global.get(\"up\")}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":260,"wires":[["5205ec1e.7b9b04"]]},{"id":"420e2c42.c78df4","type":"function","z":"f898b011.8cb44","name":"load","func":"var load = Number(global.get(\"load\")).toFixed(2);\n// var load = global.get(\"load\");\nmsg.payload = {\"size\":2,\"x\":1,\"y\":18,\"text\": load}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":300,"wires":[["5205ec1e.7b9b04"]]},{"id":"2e3ba46c.0fe9dc","type":"function","z":"f898b011.8cb44","name":"temp","func":"var temp = Number(global.get(\"temperature\")).toFixed(2);\nmsg.payload = {\"size\":2,\"x\":1,\"y\":35,\"text\": temp}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":340,"wires":[["5205ec1e.7b9b04"]]},{"id":"f27cfa58.1c4c78","type":"FillRectangle","z":"f898b011.8cb44","name":"rec","display":"1ac48f17.a5a1a1","x":610,"y":760,"wires":[]},{"id":"7bfc8649.e0442","type":"function","z":"f898b011.8cb44","name":"box","func":"msg.payload = {x:110,y:1,w:14,h:14,color:1};\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":760,"wires":[["f27cfa58.1c4c78"]]},{"id":"6d5fdd1f.4c8bac","type":"inject","z":"f898b011.8cb44","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":760,"wires":[["7bfc8649.e0442"]]},{"id":"f8c30f07.46c47","type":"mqtt out","z":"f7a0cac1.5f5af","name":"aws iot","topic":"plant","qos":"","retain":"","broker":"fd70a59a.423ef8","x":900,"y":440,"wires":[]},{"id":"2b33a2fe.1da2de","type":"mqtt in","z":"f7a0cac1.5f5af","name":"aws feedback","topic":"plant/confirmation","qos":"0","datatype":"auto","broker":"fd70a59a.423ef8","x":90,"y":620,"wires":[["bcd6ac4a.cc2cf","dc9ca4cc.cc408"]]},{"id":"bcd6ac4a.cc2cf","type":"debug","z":"f7a0cac1.5f5af","name":"aws sub","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":290,"y":620,"wires":[]},{"id":"6d83c8fc.5f01f","type":"file","z":"1c85e207.9c4a2e","name":"Write script file","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","x":860,"y":140,"wires":[[]]},{"id":"eeb4fcf3.a46998","type":"exec","z":"1c85e207.9c4a2e","command":"mktemp","addpay":false,"append":"","useSpawn":"","timer":"","name":"","x":420,"y":200,"wires":[["174aae68.46d54a"],[],[]]},{"id":"debf5652.58ae4","type":"file","z":"1c85e207.9c4a2e","name":"Delete script file","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":1020,"y":480,"wires":[[]]},{"id":"68557c2a.a3dbec","type":"exec","z":"1c85e207.9c4a2e","command":" sh ","addpay":true,"append":"","useSpawn":"","timer":"","name":"Execute the shell script","x":690,"y":340,"wires":[["debf5652.58ae4"],[],[]]},{"id":"3f681c58.774d34","type":"exec","z":"1c85e207.9c4a2e","command":"chmod +x ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1040,"y":200,"wires":[["20370339.93307c"],[],[]]},{"id":"ec010d12.46a428","type":"change","z":"1c85e207.9c4a2e","name":"","rules":[{"t":"set","p":"command","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":200,"wires":[["eeb4fcf3.a46998"]]},{"id":"6d418a.56aefe78","type":"change","z":"1c85e207.9c4a2e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"filename","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":200,"wires":[["3f681c58.774d34"]]},{"id":"174aae68.46d54a","type":"function","z":"1c85e207.9c4a2e","name":"","func":"msg.filename = msg.payload.trim();\nmsg.payload = msg.command;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":180,"wires":[["6d83c8fc.5f01f","6d418a.56aefe78"]]},{"id":"20370339.93307c","type":"change","z":"1c85e207.9c4a2e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"filename","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":340,"wires":[["68557c2a.a3dbec"]]},{"id":"cde9efe1.95e418","type":"comment","z":"1c85e207.9c4a2e","name":"Execute shell script","info":"Execute the shell script in msg.payload.","x":130,"y":40,"wires":[]},{"id":"442021b5.cc8678","type":"yaml","z":"98b0effc.65096","property":"payload","name":"\"","x":410,"y":560,"wires":[["bf99f2d0.da47a8","dacff75d.2d161"]]},{"id":"bf99f2d0.da47a8","type":"split","z":"98b0effc.65096","name":"","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":570,"y":560,"wires":[["2113e967.9483de"]]},{"id":"2113e967.9483de","type":"switch","z":"98b0effc.65096","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"CO2","vt":"str"},{"t":"cont","v":"ppmTVOC","vt":"str"},{"t":"cont","v":"temp","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":710,"y":560,"wires":[["1b480773.982911"],["d58a26c9.1beea8"],["20b2133.3774f6c"]]},{"id":"1b480773.982911","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"airCO2","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":520,"wires":[[]]},{"id":"d58a26c9.1beea8","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"airTVOC","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":560,"wires":[[]]},{"id":"20b2133.3774f6c","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"airTemp","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":600,"wires":[[]]},{"id":"dacff75d.2d161","type":"debug","z":"98b0effc.65096","name":"AIR","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":570,"y":500,"wires":[]},{"id":"3a5ddff4.6a5608","type":"exec","z":"98b0effc.65096","command":"python /home/pi/.node-red/projects/plant-monitor/read_tls2561.py","addpay":false,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"lux","x":270,"y":440,"wires":[["7a858685.7a072"],[],[]]},{"id":"598099ce.7cb408","type":"exec","z":"98b0effc.65096","command":"python3 /home/pi/.node-red/projects/plant-monitor/read_ccs811.py","addpay":false,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"air","x":270,"y":560,"wires":[["442021b5.cc8678"],[],[]]},{"id":"700c4a6e.0170ac","type":"Uptime","z":"44ed3281.52c5a4","name":"","x":260,"y":260,"wires":[["b7f7d17d.af7858","412a74d2.c5a9bc"]]},{"id":"c860c249.e63488","type":"inject","z":"44ed3281.52c5a4","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":true,"onceDelay":"2","x":110,"y":260,"wires":[["700c4a6e.0170ac","71917374.8ec324","8901f26c.4308a"]]},{"id":"b7f7d17d.af7858","type":"function","z":"44ed3281.52c5a4","name":"secs2human","func":"function secondsToString(seconds)\n{\nvar numdays = Math.floor((seconds % 31536000) / 86400); \nvar numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);\nvar numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);\nvar numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;\nreturn (numdays + \"d \" + numhours + \"h \" + numminutes + \"m\");\n\n}\nmsg.payload =secondsToString(msg.payload.uptime)\nmsg.topic=\"up\";\nreturn msg","outputs":1,"noerr":0,"x":430,"y":260,"wires":[["5b997550.5b671c"]]},{"id":"9f60e45d.02344","type":"link out","z":"44ed3281.52c5a4","name":"uptime","links":["6ab4dbc2.100f9c","30b0d6ec.62628a"],"x":935,"y":280,"wires":[]},{"id":"28fe7497.5d8f44","type":"change","z":"44ed3281.52c5a4","name":"","rules":[{"t":"set","p":"uptime","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":200,"wires":[[]]},{"id":"71917374.8ec324","type":"Loadavg","z":"44ed3281.52c5a4","name":"","x":260,"y":320,"wires":[["4432ccdf.aab3ac"]]},{"id":"4432ccdf.aab3ac","type":"function","z":"44ed3281.52c5a4","name":"get 15min","func":"msg.payload = msg.payload.loadavg[2];\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":320,"wires":[["1d96a94e.478d47"]]},{"id":"1423ebe9.abf04c","type":"change","z":"44ed3281.52c5a4","name":"","rules":[{"t":"set","p":"load","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":320,"wires":[[]]},{"id":"412a74d2.c5a9bc","type":"function","z":"44ed3281.52c5a4","name":"uptime2payload","func":"msg.payload = msg.payload.uptime;\nreturn msg","outputs":1,"noerr":0,"x":440,"y":200,"wires":[["28fe7497.5d8f44"]]},{"id":"5b997550.5b671c","type":"change","z":"44ed3281.52c5a4","name":"","rules":[{"t":"set","p":"up","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":260,"wires":[["9f60e45d.02344","bae334df.948eb"]]},{"id":"8901f26c.4308a","type":"Memory","z":"44ed3281.52c5a4","name":"","x":260,"y":380,"wires":[["951de3fb.bc16"]]},{"id":"951de3fb.bc16","type":"function","z":"44ed3281.52c5a4","name":"memusage","func":"msg.payload = msg.payload.memusage;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":380,"wires":[["15099e81.36e459"]]},{"id":"15099e81.36e459","type":"yaml","z":"44ed3281.52c5a4","property":"payload","name":"","x":590,"y":380,"wires":[["863a0abb.ccf9e"]]},{"id":"863a0abb.ccf9e","type":"change","z":"44ed3281.52c5a4","name":"","rules":[{"t":"set","p":"memory","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":380,"wires":[["bb6c6b35.c9b428"]]},{"id":"d1f38be4.25fa1","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"moisture","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1240,"wires":[[]]},{"id":"7325345c.8395d4","type":"range","z":"98b0effc.65096","minin":"2.4","maxin":"3.65","minout":"100","maxout":"0","action":"scale","round":false,"property":"payload","name":"","x":320,"y":1240,"wires":[["60c2a6bc.96b5c8"]]},{"id":"927c9eeb.97c33","type":"exec","z":"98b0effc.65096","command":"python /home/pi/.node-red/projects/plant-monitor/read_hx711.py","addpay":false,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"weight","x":270,"y":680,"wires":[["14d847a9.f1b7b8"],[],[]]},{"id":"14d847a9.f1b7b8","type":"yaml","z":"98b0effc.65096","property":"payload","name":"\"","x":410,"y":680,"wires":[["f0a8a35e.8413b"]]},{"id":"58561c1d.fc26e4","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"weight","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":680,"wires":[[]]},{"id":"f0a8a35e.8413b","type":"function","z":"98b0effc.65096","name":"get weight","func":"msg.payload = msg.payload.weight;\nnode.status({text: msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":680,"wires":[["4384bac7.c24a8c"]]},{"id":"a40e8b5f.1f01e8","type":"comment","z":"98b0effc.65096","name":"calibration values","info":"empty tray: - 20527\n1kg ish: 1414391","x":780,"y":640,"wires":[]},{"id":"4384bac7.c24a8c","type":"range","z":"98b0effc.65096","minin":"-20500","maxin":"1414400","minout":"0","maxout":"1000","action":"scale","round":true,"property":"payload","name":"0-1kg int","x":760,"y":680,"wires":[["58561c1d.fc26e4","bf5a7e59.87aef"]]},{"id":"bf5a7e59.87aef","type":"debug","z":"98b0effc.65096","name":"weight in grams","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":940,"y":720,"wires":[]},{"id":"3baceda1.d3ef02","type":"change","z":"c16ac57b.fa21f","name":"","rules":[{"t":"set","p":"filename","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":220,"wires":[["2ee72ba5.62ce54","60a4a230.fe19ec"]]},{"id":"2a58d67d.dd1a3a","type":"string","z":"c16ac57b.fa21f","name":"","methods":[{"name":"replaceAll","params":[{"type":"str","value":"/home/pi/pictures/"},{"type":"str","value":""}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":450,"y":360,"wires":[["ab6d3327.3e6a38","37748cb0.5ecee4"]]},{"id":"67700db4.c799b4","type":"function","z":"c16ac57b.fa21f","name":"get filename","func":"msg.payload=global.get(\"filename\");\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":360,"wires":[["2a58d67d.dd1a3a"]]},{"id":"39896ee2.ff3d2a","type":"debug","z":"c16ac57b.fa21f","name":"string","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":420,"wires":[]},{"id":"60a4a230.fe19ec","type":"delay","z":"c16ac57b.fa21f","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1020,"y":220,"wires":[["4bc4042c.baff8c"]]},{"id":"5f3ca5ce.e76d0c","type":"catch","z":"98b0effc.65096","name":"","scope":null,"uncaught":false,"x":980,"y":40,"wires":[["efaa50f2.b572"]]},{"id":"c18b0548.c14ab8","type":"catch","z":"f7a0cac1.5f5af","name":"","scope":null,"uncaught":false,"x":960,"y":40,"wires":[["ca58dc89.2041e"]]},{"id":"37748cb0.5ecee4","type":"change","z":"c16ac57b.fa21f","name":"","rules":[{"t":"set","p":"picture","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":420,"wires":[["39896ee2.ff3d2a"]]},{"id":"119e9cbb.69a0ab","type":"inject","z":"c16ac57b.fa21f","name":"/1h","topic":"","payload":"true","payloadType":"bool","repeat":"3600","crontab":"","once":true,"onceDelay":"60","x":90,"y":240,"wires":[["d16469e1.589388"]]},{"id":"27b09427.38588c","type":"function","z":"98b0effc.65096","name":"engouh lx for pic?","func":"if (msg.payload > 100) {\n    msg.takepicture = true;\n    node.status({fill:\"green\",shape:\"dot\",text:\"enough light\"});\n} else {\n    msg.takepicture = false;\n    node.status({fill:\"red\",shape:\"ring\",text:\"too dark\"})\n}\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":420,"wires":[["8d9057fc.fc0b28"]]},{"id":"8d9057fc.fc0b28","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"takepicture","pt":"global","to":"takepicture","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":420,"wires":[[]]},{"id":"d16469e1.589388","type":"switch","z":"c16ac57b.fa21f","name":"enough lx?","property":"takepicture","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":240,"wires":[["d2639062.f8449"],["2673bc74.8b9f44"]]},{"id":"2673bc74.8b9f44","type":"function","z":"c16ac57b.fa21f","name":"not enought light","func":"msg.payload = \"not enough light\";\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":260,"wires":[["743e5ee7.b3a538"]]},{"id":"743e5ee7.b3a538","type":"change","z":"c16ac57b.fa21f","name":"","rules":[{"t":"set","p":"picture","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":260,"wires":[[]]},{"id":"bb6c6b35.c9b428","type":"debug","z":"44ed3281.52c5a4","name":"memory %","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":380,"wires":[]},{"id":"bae334df.948eb","type":"debug","z":"44ed3281.52c5a4","name":"uptime","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":220,"wires":[]},{"id":"dc9ca4cc.cc408","type":"link out","z":"f7a0cac1.5f5af","name":"aws iot feedback","links":["e0b6f3e3.32e4e8"],"x":255,"y":680,"wires":[]},{"id":"e0b6f3e3.32e4e8","type":"link in","z":"f898b011.8cb44","name":"display box on lcd","links":["dc9ca4cc.cc408"],"x":135,"y":540,"wires":[["79be3916.3bba28"]]},{"id":"246dc1b3.b517ae","type":"Clear","z":"f898b011.8cb44","name":"clear oled","display":"1ac48f17.a5a1a1","x":620,"y":160,"wires":[]},{"id":"5d1414b8.73fa14","type":"inject","z":"f898b011.8cb44","name":"clear lcd","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":160,"wires":[["246dc1b3.b517ae"]]},{"id":"fa68fdee.60d85","type":"String","z":"f898b011.8cb44","name":"oled","display":"1ac48f17.a5a1a1","x":610,"y":600,"wires":[]},{"id":"6f396aa3.300adc","type":"function","z":"f898b011.8cb44","name":"mqtt text","func":"var text = msg.payload;\nmsg.payload = {\"size\":1,\"x\":1,\"y\":1,\"text\": text}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":600,"wires":[["fa68fdee.60d85"]]},{"id":"1739a40d.515894","type":"inject","z":"f898b011.8cb44","name":"","topic":"","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":600,"wires":[["6f396aa3.300adc"]]},{"id":"79be3916.3bba28","type":"yaml","z":"f898b011.8cb44","property":"payload","name":"","x":230,"y":540,"wires":[["6f396aa3.300adc"]]},{"id":"a0b19a3d.842938","type":"inject","z":"f898b011.8cb44","name":"clear aws","topic":"","payload":"   ","payloadType":"str","repeat":"600","crontab":"","once":true,"onceDelay":"0.6","x":250,"y":660,"wires":[["6f396aa3.300adc"]]},{"id":"59720841.482fc8","type":"comment","z":"c16ac57b.fa21f","name":"no frames calc","info":"total duration of event 7d\nlenght of video - 20sec?\nframes per second - 50\n\n50 * 20 = 1000 picutres\n\n7 days (daylight 8 - 20) 12h/d\n1d = 12h * 60min * 60 sec = 43200 secs\n7d = 7 * 43200 secs = 302400secs\n\n302400 / 1000 = 30240 sec between pictures\n\n1.2 between pictures ~ 1h","x":100,"y":180,"wires":[]},{"id":"9b603aae.4de008","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"presence","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1520,"wires":[[]]},{"id":"7a9b897a.f107","type":"function","z":"98b0effc.65096","name":"0/1","func":"if (msg.payload > 2) {\n    msg.payload = \">>>\";\n    msg.increment = 1;\n    node.status({fill:\"green\",shape:\"ring\",text:\"presence\"});\n} else {\n    msg.payload = \"   \"; \n    msg.increment = 0;\n    node.status({});   // to clear the status\n}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1360,"wires":[["d1022443.67d0e","c6cd97f8.ca4e98","89e54e2f.a1a4c"]]},{"id":"f4d9c349.68176","type":"smooth","z":"98b0effc.65096","name":"mean","property":"payload","action":"mean","count":"10","round":"","mult":"single","reduce":false,"x":290,"y":880,"wires":[["eb35ec51.a7155"]]},{"id":"4f33880d.f32a3","type":"smooth","z":"98b0effc.65096","name":"mean","property":"payload","action":"mean","count":"10","round":"","mult":"single","reduce":false,"x":290,"y":800,"wires":[["ba496a3.2fccf18"]]},{"id":"8ca6e623.6d0388","type":"rpi-gpio out","z":"f898b011.8cb44","name":"LED green","pin":"40","set":true,"level":"0","freq":"","out":"out","x":630,"y":60,"wires":[]},{"id":"ba496a3.2fccf18","type":"function","z":"98b0effc.65096","name":".00 V","func":"newMsg = {};\nnewMsg.payload = JSON.parse(Number(msg.payload).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":470,"y":800,"wires":[["f1548d56.de3a38"]]},{"id":"eb35ec51.a7155","type":"function","z":"98b0effc.65096","name":".00 mA","func":"newMsg = {};\nnewMsg.payload = JSON.parse(Number(msg.payload).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":480,"y":880,"wires":[["321b7151.bd2ade"]]},{"id":"1d96a94e.478d47","type":"function","z":"44ed3281.52c5a4","name":".00","func":"newMsg = {};\nnewMsg.payload = JSON.parse(Number(msg.payload).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":590,"y":320,"wires":[["1423ebe9.abf04c"]]},{"id":"a14b7a98.a73ba8","type":"function","z":"98b0effc.65096","name":"power W","func":"var volt = global.get(\"voltage\");\nvar current = global.get(\"current\");\nvar power = (volt * current) / 1000;\nmsg.payload = JSON.parse(Number(power).toFixed(2));\nnode.status({text: msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":940,"wires":[["5e7edeb4.960a5"]]},{"id":"428b093.fec00f8","type":"delay","z":"98b0effc.65096","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":940,"wires":[["a14b7a98.a73ba8"]]},{"id":"7c85063b.5035c","type":"catch","z":"c16ac57b.fa21f","name":"","scope":null,"uncaught":false,"x":940,"y":40,"wires":[["ea601e96.60b4d8"]]},{"id":"3c378efd.bbd162","type":"String","z":"f898b011.8cb44","name":"oled","display":"1ac48f17.a5a1a1","x":610,"y":420,"wires":[]},{"id":"392cb446.83f5fc","type":"function","z":"f898b011.8cb44","name":">>>","func":"var text = msg.payload;\nmsg.payload = {\"size\":1,\"x\":110,\"y\":1,\"text\": text}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":420,"wires":[["3c378efd.bbd162"]]},{"id":"60c2a6bc.96b5c8","type":"function","z":"98b0effc.65096","name":".00 %","func":"newMsg = {};\nnewMsg.payload = JSON.parse(Number(msg.payload).toFixed(2));\nnode.status({text: newMsg.payload});\nreturn newMsg;","outputs":1,"noerr":0,"x":510,"y":1240,"wires":[["d1f38be4.25fa1"]]},{"id":"b87026a0.26eb6","type":"link out","z":"98b0effc.65096","name":"presence sensor out","links":["1f3560e7.248a37"],"x":615,"y":1400,"wires":[]},{"id":"1f3560e7.248a37","type":"link in","z":"f898b011.8cb44","name":"LCD presence in","links":["b87026a0.26eb6"],"x":135,"y":420,"wires":[["392cb446.83f5fc"]]},{"id":"14868459.bf852c","type":"inject","z":"44ed3281.52c5a4","name":"plant age","topic":"","payload":"","payloadType":"date","repeat":"7","crontab":"","once":true,"onceDelay":0.1,"x":250,"y":520,"wires":[["cbe0ebef.0397e"]]},{"id":"4d749c32.d58c04","type":"comment","z":"44ed3281.52c5a4","name":"1588192356793","info":"","x":240,"y":480,"wires":[]},{"id":"54632f6.272695","type":"function","z":"44ed3281.52c5a4","name":"secs2human","func":"function secondsToString(seconds)\n{\nvar numdays = Math.floor((seconds % 31536000) / 86400); \nvar numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);\nvar numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);\nvar numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;\nreturn (numdays + \"d \" + numhours + \"h \" + numminutes + \"m\");\n\n}\nmsg.payload =secondsToString(msg.payload);\nnode.status({text: msg.payload});\nmsg.topic=\"up\";\nreturn msg","outputs":1,"noerr":0,"x":590,"y":520,"wires":[["ac8e1bdc.e3bcd8"]]},{"id":"cbe0ebef.0397e","type":"function","z":"44ed3281.52c5a4","name":"time diff","func":"msg.payload = Math.floor((msg.payload -1588192356793) / 1000);\nnode.status({text: msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":520,"wires":[["54632f6.272695"]]},{"id":"ac8e1bdc.e3bcd8","type":"change","z":"44ed3281.52c5a4","name":"","rules":[{"t":"set","p":"age","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":520,"wires":[[]]},{"id":"5e7edeb4.960a5","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"power","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":940,"wires":[[]]},{"id":"792d3341.d009bc","type":"counter","z":"98b0effc.65096","name":"","init":"0","step":"1","lower":null,"upper":null,"mode":"increment","outputs":"1","x":700,"y":1360,"wires":[["a268fc2b.bd1ac8"]]},{"id":"d1022443.67d0e","type":"delay","z":"98b0effc.65096","name":"1/m","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":1360,"wires":[["792d3341.d009bc"]]},{"id":"4512474.90ab138","type":"link out","z":"f7a0cac1.5f5af","name":"mqtt trigger out","links":["55a83f05.8888b"],"x":455,"y":500,"wires":[]},{"id":"55a83f05.8888b","type":"link in","z":"98b0effc.65096","name":"counter reset in","links":["4512474.90ab138"],"x":275,"y":1300,"wires":[["2d50907.c6bf67"]]},{"id":"77add07a.12b45","type":"function","z":"98b0effc.65096","name":"rst","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":1300,"wires":[["792d3341.d009bc"]]},{"id":"a268fc2b.bd1ac8","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":1520,"wires":[["a635fce2.788d98","3e3cfddb.382da2"]]},{"id":"2d50907.c6bf67","type":"delay","z":"98b0effc.65096","name":"d 1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":1300,"wires":[["77add07a.12b45"]]},{"id":"70e2175.60ddf68","type":"change","z":"f7a0cac1.5f5af","name":"","rules":[{"t":"set","p":"interval","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":360,"wires":[[]]},{"id":"9693afb2.530278","type":"inject","z":"f7a0cac1.5f5af","name":"","topic":"","payload":"15","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":360,"wires":[["70e2175.60ddf68"]]},{"id":"a635fce2.788d98","type":"function","z":"98b0effc.65096","name":"presense %","func":"var presense_factor = (msg.count/global.get(\"interval\")*100);\nmsg.payload = JSON.parse(Number(presense_factor).toFixed(0));\nnode.status({text: msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":1520,"wires":[["9b603aae.4de008"]]},{"id":"1a920d14.e83223","type":"function","z":"f898b011.8cb44","name":"presence","func":"var text = Number(global.get(\"presence\")).toFixed(0);\n\nsetTimeout(function(){\n    node.status({fill:\"green\", shape:\"ring\", text:\"printed\"});\n    msg.payload = {\"size\":1,\"x\":86,\"y\":1,\"text\": text};\n    node.send(msg);\n}, 2000);\nnode.status({fill:\"blue\", shape:\"ring\", text:'clearing fields'});\nmsg.payload = {\"size\":1,\"x\":86,\"y\":1,\"text\": \"   \"};\nnode.send(msg);\n// node.status({});   // to clear the status","outputs":1,"noerr":0,"x":340,"y":200,"wires":[["5205ec1e.7b9b04"]]},{"id":"3def2f42.dddaa","type":"rpi-gpio out","z":"f7a0cac1.5f5af","name":"LED orange","pin":"36","set":true,"level":"0","freq":"","out":"out","x":670,"y":380,"wires":[]},{"id":"d71d726b.96ded","type":"rpi-gpio out","z":"44ed3281.52c5a4","name":"LED red","pin":"38","set":true,"level":"0","freq":"","out":"out","x":880,"y":80,"wires":[]},{"id":"d918c2db.43037","type":"function","z":"44ed3281.52c5a4","name":"0/1","func":"msg.payload = 1;\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":80,"wires":[[]]},{"id":"72f25058.db85f","type":"inject","z":"44ed3281.52c5a4","name":"Reset","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":630,"y":40,"wires":[["d71d726b.96ded"]]},{"id":"2fbfd2ab.44b2ae","type":"catch","z":"44ed3281.52c5a4","name":"","scope":null,"uncaught":false,"x":120,"y":80,"wires":[["65ac1dda.bc3f1c"]]},{"id":"65ac1dda.bc3f1c","type":"link out","z":"44ed3281.52c5a4","name":"Sys err","links":["128ce49.3c3579b"],"x":235,"y":80,"wires":[]},{"id":"128ce49.3c3579b","type":"link in","z":"44ed3281.52c5a4","name":"Led err","links":["65ac1dda.bc3f1c","ea601e96.60b4d8","dbb509cf.f21248","efaa50f2.b572","ca58dc89.2041e"],"x":515,"y":80,"wires":[["d918c2db.43037","fc831016.ce6a38"]]},{"id":"ea601e96.60b4d8","type":"link out","z":"c16ac57b.fa21f","name":"Cam err","links":["128ce49.3c3579b"],"x":1055,"y":40,"wires":[]},{"id":"f266fad2.cc2a58","type":"catch","z":"f898b011.8cb44","name":"","scope":null,"uncaught":false,"x":940,"y":40,"wires":[["dbb509cf.f21248"]]},{"id":"dbb509cf.f21248","type":"link out","z":"f898b011.8cb44","name":"LCD err","links":["128ce49.3c3579b"],"x":1055,"y":40,"wires":[]},{"id":"efaa50f2.b572","type":"link out","z":"98b0effc.65096","name":"Sensors err","links":["128ce49.3c3579b"],"x":1095,"y":40,"wires":[]},{"id":"ca58dc89.2041e","type":"link out","z":"f7a0cac1.5f5af","name":"MQTT err","links":["128ce49.3c3579b"],"x":1075,"y":40,"wires":[]},{"id":"4bc4042c.baff8c","type":"link out","z":"c16ac57b.fa21f","name":"filename","links":["372dd93c.6d73ee"],"x":1135,"y":220,"wires":[]},{"id":"372dd93c.6d73ee","type":"link in","z":"c16ac57b.fa21f","name":"s3","links":["4bc4042c.baff8c"],"x":155,"y":360,"wires":[["67700db4.c799b4"]]},{"id":"fc831016.ce6a38","type":"debug","z":"44ed3281.52c5a4","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":630,"y":120,"wires":[]},{"id":"92ee9f49.d0f8e","type":"inject","z":"c16ac57b.fa21f","name":"","topic":"","payload":"--","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":430,"y":420,"wires":[["37748cb0.5ecee4"]]},{"id":"3b0819d1.801bfe","type":"comment","z":"f7a0cac1.5f5af","name":"interval","info":"the interval value is needed to calculate presence factor","x":70,"y":320,"wires":[]},{"id":"8136d7ed.567b6","type":"function","z":"98b0effc.65096","name":"VPD [kPa]","func":"var T = global.get(\"temperature\");\nvar RH = global.get(\"humidity\");\n\n// svp - saturated vapour pressure\n// avp - actual vapour pressure\n\nvar svp = 610.7 * Math.pow(10, (7.5 * T / (T + 237.3)));\nvar avp = RH * svp / 100;\nvar vpd = svp - avp;\nmsg.payload = JSON.parse(Number(vpd/1000).toFixed(2));\nnode.status({text: msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":320,"wires":[["7987bae6.bf3c5c"]]},{"id":"7987bae6.bf3c5c","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"vpd","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":320,"wires":[[]]},{"id":"905bfd7e.2b551","type":"delay","z":"98b0effc.65096","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380,"y":320,"wires":[["8136d7ed.567b6"]]},{"id":"9844143d.fb438","type":"ads1x15-raspi","z":"98b0effc.65096","property":"ch0","name":"ch0","chip":"IC_ADS1015","i2c_address":"ADDRESS_0x48","channel":"CHANNEL_0","samplesPerSecond0":"SPS_920","samplesPerSecond1":"SPS_128","progGainAmp":"PGA_4_096V","x":110,"y":1140,"wires":[["bf3d10ff.1b0d58"]]},{"id":"bf3d10ff.1b0d58","type":"ads1x15-raspi","z":"98b0effc.65096","property":"ch1","name":"ch1","chip":"IC_ADS1015","i2c_address":"ADDRESS_0x48","channel":"CHANNEL_1","samplesPerSecond0":"SPS_920","samplesPerSecond1":"SPS_128","progGainAmp":"PGA_6_144V","x":110,"y":1220,"wires":[["c65e4fdd.920978"]]},{"id":"25a7eb84.1855f4","type":"inject","z":"98b0effc.65096","name":"sample","topic":"","payload":"","payloadType":"date","repeat":"11","crontab":"","once":true,"onceDelay":"0.5","x":100,"y":1080,"wires":[["9844143d.fb438"]]},{"id":"c65e4fdd.920978","type":"function","z":"98b0effc.65096","name":"","func":"var msg0 = {};\nvar msg1 = {};\nmsg0.payload = msg.ch0[\"ADS1015 • I2C_ADDRESS_0x48 • Channel A0-GND • Voltage\"];\nmsg1.payload = msg.ch1[\"ADS1015 • I2C_ADDRESS_0x48 • Channel A1-GND • Voltage\"];\n\n// var msg0 = JSON.parse(Number(ch0).toFixed(2));\n// var msg1 = JSON.parse(Number(ch0).toFixed(2));\n\nreturn [msg0, msg1];","outputs":2,"noerr":0,"x":110,"y":1300,"wires":[["7325345c.8395d4"],["7a9b897a.f107"]]},{"id":"f2d7167f.1658b8","type":"comment","z":"98b0effc.65096","name":"scaling","info":"dry air - 3.62\nin water - 2.4V","x":310,"y":1200,"wires":[]},{"id":"c6cd97f8.ca4e98","type":"delay","z":"98b0effc.65096","name":"1/m","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":1400,"wires":[["b87026a0.26eb6"]]},{"id":"8eccebbb.abc658","type":"link in","z":"44ed3281.52c5a4","name":"red led in","links":["cd8029b1.9acf4"],"x":760,"y":120,"wires":[["d71d726b.96ded"]]},{"id":"cd8029b1.9acf4","type":"link out","z":"98b0effc.65096","name":"presence out","links":["8eccebbb.abc658"],"x":335,"y":1440,"wires":[]},{"id":"89e54e2f.a1a4c","type":"change","z":"98b0effc.65096","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"increment","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":1440,"wires":[["cd8029b1.9acf4"]]},{"id":"fd7a0017.4d40b8","type":"inject","z":"91f789ec.a4f17","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":200,"wires":[["a598fda6.0ad14"]]},{"id":"a598fda6.0ad14","type":"rpi-gpio out","z":"91f789ec.a4f17","name":"water pump","pin":"22","set":true,"level":"0","freq":"","out":"out","x":430,"y":200,"wires":[]},{"id":"d7e08827.229ee8","type":"inject","z":"91f789ec.a4f17","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":260,"wires":[["a598fda6.0ad14"]]},{"id":"3583c6fb.b59dc2","type":"inject","z":"98b0effc.65096","name":"0","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":"0.3","x":730,"y":500,"wires":[["1b480773.982911","d58a26c9.1beea8","20b2133.3774f6c"]]},{"id":"f134e487.ee7a78","type":"comment","z":"98b0effc.65096","name":"I2C list","info":"lx -\nair - \ntemp - \nad - \npower - \noled - \n\nIF CCS811 stopsworking check \nsudo nano /boot/config.txt\nfor I2C speed\ndtparam=i2c_baudrate=10000","x":70,"y":560,"wires":[]},{"id":"3e3cfddb.382da2","type":"debug","z":"98b0effc.65096","name":"count","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":550,"y":1460,"wires":[]}]